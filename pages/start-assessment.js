import Head from 'next/head';
import Image from 'next/image';

import { useRouter } from 'next/router';
import { useState } from 'react';

export default function Home() {

  const router = useRouter();
  const [currentQues, setCurrentQues] = useState(0);
  const [answers, setAnswers] = useState({  });
  const [error, setError] = useState("");

  const questions = [
    {
      ques: 'Do you have headaches?',
      opts: [
        {opt: "No", rating: 0},
        {opt: "Yes", rating: 100},
      ]
    },
    {
      ques: 'How would you describe your headaches?',
      opts: [
        {opt: "i don't have any headaches", rating: 0},
        {opt: "Mild", rating: 30},
        {opt: "Serious", rating: 60},
        {opt: "Migranes", rating: 100},
      ]
    },
    {
      ques: 'Are these headaches accompanied with nausea?',
      opts: [
        {opt: "No they are not", rating: 0},
        {opt: "Sometimes", rating: 30},
        {opt: "Most times", rating: 75},
        {opt: "Always", rating: 100},
      ]
    },
    {
      img: "sore-throat.svg",
      ques: 'Do you have sore throat?',
      opts: [
        {opt: "No", rating: 0},
        {opt: "Yes", rating: 100},
      ]
    },
    {
      img: "sore-throat.svg",
      ques: 'If yes, for how long have you had this sore throat?',
      opts: [
        {opt: "I don't have sore throat", rating: 0},
        {opt: "Less than a week", rating: 30},
        {opt: "2 - 4 weeks", rating: 70},
        {opt: "5+ weeks", rating: 100},
      ]
    },
    {
      img: "sore-throat.svg",
      ques: 'How difficult, is it swallowing food items or drinks?',
      opts: [
        {opt: "I don't have sore throat", rating: 0},
        {opt: "Negligible pain", rating: 20},
        {opt: "Quite difficult", rating: 40},
        {opt: "Very problematic", rating: 80},
      ]
    },
    {
      img: "nasal-congestion.svg",
      ques: 'Do you have cough, cold or nasal congestion?',
      opts: [
        {opt: "No", rating: 20},
        {opt: "Yes", rating: 100},
      ]
    },
    {
      img: "nasal-congestion.svg",
      ques: 'If yes, for how long have you had cough, cold or nasal congestion?',
      opts: [
        {opt: "I don't have these symptoms", rating: 10},
        {opt: "Less than a week", rating: 30},
        {opt: "2 - 4 weeks", rating: 70},
        {opt: "5+ weeks", rating: 100},
      ]
    },
    {
      img: "lungs.svg",
      ques: 'Do you have difficulty breathing?',
      opts: [
        {opt: "No", rating: 0},
        {opt: "Yes", rating: 100},
      ]
    },
    {
      img: "lungs.svg",
      ques: 'If yes, for how long have you had difficulty breathing?',
      opts: [
        {opt: "I don't difficulty breathing", rating: 0},
        {opt: "Less than a week", rating: 30},
        {opt: "2 - 4 weeks", rating: 70},
        {opt: "5+ weeks", rating: 100},
      ]
    },
    {
      img: "lungs.svg",
      ques: 'Have you had any other illness that results in difficulty breathing in the past 60days such as tuberculosis or pneumonia?',
      opts: [
        {opt: "No, I have never been diagnosed with tuberculosis or pneumonia", rating: 0},
        {opt: "Yes, I have been diagnosed with tuberculosis or pneumonia but not recently", rating: 90},
        {opt: "Yes, within 60days", rating: 60},
      ]
    },
    {
      img: "lungs.svg",
      ques: 'How severe are your chest pain, if you do experience it?',
      opts: [
        {opt: "No, i don't experience it", rating: 0},
        {opt: "Mild", rating: 20},
        {opt: "Serious", rating: 50},
        {opt: "Severe", rating: 100},
      ]
    },
    {
      img: "",
      ques: 'Do you experience loss of speech or mobility, or confusion?',
      opts: [
        {opt: "No", rating: 0},
        {opt: "Yes", rating: 100},
      ]
    },
    {
      img: "",
      ques: 'Have you come in contact with anyone that has covid within the past 30days?',
      opts: [
        {opt: "No", rating: 0},
        {opt: "Not sure", rating: 20},
        {opt: "Yes", rating: 100},
      ]
    },
  ];

  const handleNav = (text, ques) => {
    if(text === "prev") return setCurrentQues(currentQues-1);
    if(answers[ques] === undefined || answers[ques] === null) return setError(ques);

    setError("");
    return setCurrentQues(currentQues+1)
  }


  const handleSubmit = () => {
    let calc = 0;
    for(let i in answers) calc += parseInt(answers[i]);
    let finalscore = Math.ceil(calc/questions.length);

    router.push('/result?score='+finalscore);
  }


  return (
    <div>
      <Head>
        <title>Covid Test</title>
        <meta name="description" content="Generated by create next app" />
      </Head>


      {/* <div className='fixed w-full h-full bg-app-primary'></div> */}
      <main className="">

        {questions.map(({ques, opts, img}, index) => (
          (index === currentQues) && 
          
          <div key={index} className='flex flex-col justify-center items-center relative w-full lg:h-screen p-8 max-w-lg lg:p-20 mx-auto space-y-8 z-100 backdrop-blur-2xl isolate'>
            <div className='relative w-full h-40'>
              {img ? <Image src={`/img/${img}`} layout='fill' objectFit='contain' /> : <Image src="/img/medical-check.svg" layout='fill' objectFit='contain' />}
            </div>

            <div className='w-full'>
              <p className="font-DM-Serif text-2xl self-start">{index+1}. {ques}</p>
              {(error === ques) && <p className='text-xs text-center mt-2 text-red-600 font-bold'>Please choose an answer</p>}
            </div>

            <div className='space-y-3 w-full'>
              {opts.map(({opt, rating}, index) => (
                <p key={index} onClick={() => {setAnswers({...answers, [ques]: rating}); setError("")}} className={`${(answers[ques] === rating) && '!bg-[#5025d8] !border-[#5025d8] !text-white'} text-sm self-start p-3 border border-black w-full hover:border-[#5025d8] hover:bg-[#5025d8] hover:text-white cursor-pointer`}><strong className="pr-2">{String.fromCharCode(65 + index)}.</strong> {opt}</p>
              ))}
            </div>

            <div className='grid grid-cols-2 w-full gap-4'>
              {index !== 0 ? 
                <div onClick={() => handleNav('prev', ques)} className='cursor-pointer block w-full text-center text-white font-DM-Serif p-3 bg-[#5025d8]'>
                  Previous
                </div>:
                <div className=''></div>
              }

              {index+1 !== questions.length ? 
                <div onClick={() => handleNav('next', ques)} className='cursor-pointer block w-full text-center text-white font-DM-Serif p-3 bg-[#5025d8]'>
                  Next
                </div>:
                <div onClick={handleSubmit} className='cursor-pointer block w-full text-center text-white font-DM-Serif p-3 bg-[#5025d8]'>
                  Submit
                </div>
              }
            </div>
          </div>
        ))}
        

      </main>

    </div>
  )
}
